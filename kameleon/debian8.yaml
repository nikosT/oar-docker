#==============================================================================
# vim: softtabstop=2 shiftwidth=2 expandtab fenc=utf-8 cc=81 tw=80
#==============================================================================
#
# DESCRIPTION: <MY RECIPE DESCRIPTION>
#
#==============================================================================
---
extend: default/from_docker/from_docker.yaml

global:
  # You should specify this in the global of your recipe
  distrib: debian
  release: jessie
  from_docker_image: "debian:jessie"

  to_docker_image: "oardocker/$${kameleon_recipe_name}:$${version}"

  default_locales: fr_FR en_US
  default_lang: fr_FR.UTF-8
  default_timezone: Europe/Paris

  # Apt recipe options
  apt_repository: http://ftp.debian.org/debian/
  apt_enable_contrib: true
  apt_enable_nonfree: true

  # System variables. Required by kameleon engine
  # Include specific steps
  include_steps:
    - $${distrib}/$${release}
    - $${distrib}

  ## User varibales : used by the recipe
  user_name: docker
  user_password: $${user_name}
  root_password: $${user_name}

  bootstrap_packages: >
    bsdutils ca-certificates perl perl-modules locales man-db less
    libui-dialog-perl dialog isc-dhcp-client ifupdown iptables iputils-ping
    iproute2 netbase net-tools psmisc openssh-server acpid acpi-support-base
    systemd systemd-sysv systemd-cron dbus

  core_packages: >
    debian-keyring sudo less vim nano bash-completion apt-transport-https
    ca-certificates psmisc openssh-client curl wget iptables socat pciutils
    rsyslog nmap locales net-tools iproute2 net-tools perl perl-base
    build-essential taktuk libdbi-perl libsort-versions-perl libdbd-pg-perl
    postgresql-client inetutils-ping git tmux openssh-server netcat
    unionfs-fuse procps libdatetime-perl libterm-ui-perl rsync socat
    python python3 python-dev python3-dev python-pip python3-pip
    python-psutil python-psycopg2 python3-psycopg2 python-virtualenv

  frontend_dependencie: >
    libsort-naturally-perl libjson-perl libyaml-perl libappconfig-perl
    libtie-ixhash-perl libwww-perl libcgi-fast-perl libapache2-mod-fastcgi
    php5 php5-fpm libapache2-mod-php5 php5-mcrypt php5-pgsql phppgadmin
    libjs-jquery rubygems ruby-dev php-apc ruby-rspec spawn-fcgi fcgiwrap
    apache2-suexec-custom apache2 apache2-mpm-prefork oidentd nginx

  server_packages: >
    postgresql

bootstrap:
  - "@base"

setup:
  - configure_apt:
    - repository: $${apt_repository}
    - enable_contrib_repo: $${apt_enable_contrib}
    - enable_nonfree_repo: $${apt_enable_nonfree}
  - upgrade_system:
    - dist_upgrade: true
  # Packages installation
  - install_software:
    - packages: $${core_packages}
  - install_software:
    - packages: $${frontend_dependencie}
  - install_software:
    - packages: $${server_packages}
  # Configuration
  - configure_system:
    - locales: $${default_locales}
    - lang: $${default_lang}
    - timezone: $${default_timezone}
  - oardocker_custom_image
  - clean_system:
    - enable_lighten: true

export:
  - "@base"
